{"version":3,"file":"index.js","mappings":"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","sources":["webpack://woocommerce-infinitepay/./src/index.js"],"sourcesContent":["(function ($) {\n    \"use strict\"\n\n    $(function () {\n        let infinite_pay_submit = false\n        let additionalInfo = {}\n        let iPay\n\n        function getIPay() {\n            if (!!iPay) return iPay\n            iPay = window.iPay\n            return iPay\n        }\n\n        function getCheckoutForm() {\n            return document.querySelector('#infinitepay-form')\n        }\n\n        function validateInputs() {\n            clearErrors()\n            const mainInputs = validateMainInputs()\n            const additionalInputs = validateAdditionalInputs()\n\n            if (mainInputs || additionalInputs) {\n                focusInputWithError()\n                return false\n            }\n            return true\n        }\n\n        function clearErrors() {\n            for (\n                let i = 0;\n                i < document.querySelectorAll('[data-checkout]').length;\n                i++\n            ) {\n                const errorElement = document.querySelectorAll('[data-checkout]')[i]\n                errorElement.classList.remove('ip-form-control-error')\n            }\n            for (\n                let j = 0;\n                j < document.querySelectorAll('.ip-error').length;\n                j++\n            ) {\n                const errorMessage = document.querySelectorAll('.ip-error')[j]\n                errorMessage.style.display = 'none'\n            }\n        }\n\n        function validateMainInputs() {\n            let hasEmpty = false\n            const form = getCheckoutForm()\n            const formInputs = form.querySelectorAll('[data-checkout]')\n            const mainInputs = [\n                'installments',\n                'cardSecurityCode',\n                'cardExpirationDate',\n                'cardNumber',\n                'docNumber',\n            ]\n\n            for (\n                let k = 0;\n                k < formInputs.length;\n                k++\n            ) {\n                const element = formInputs[k]\n                if (mainInputs.indexOf(element.getAttribute('data-checkout')) > -1) {\n                    let withError = false\n                    if (element.value === '-1' || element.value === '') withError = true\n                    if (element.id === 'ip_docNumber') withError = !(validateCpf(element.value))\n\n                    if (withError) {\n                        const errorSpan = form.querySelectorAll(\n                            'span[data-main=\"#' + element.id + '\"]'\n                        )\n                        if (errorSpan.length > 0) errorSpan[0].style.display = 'inline-block'\n                        element.classList.add('ip-form-control-error')\n                        hasEmpty = true\n                    }\n                }\n            }\n\n            return hasEmpty\n        }\n\n        function validateAdditionalInputs() {\n            let hasEmpty = false\n            if (additionalInfo.cardholderIdentificationType) {\n                const inputDocType = document.getElementById('docType')\n                if (inputDocType.value === '-1' || inputDocType === '') {\n                    inputDocType.classList.add('ip-form-control-error')\n                    hasEmpty = true\n                }\n            }\n            if (additionalInfo.cardholderIdentificationNumber) {\n                const inputDocNumber = document.getElementById('docNumber')\n                if (inputDocNumber.value === '-1' || inputDocNumber === '') {\n                    inputDocNumber.classList.add('ip-form-control-error')\n                    document.getElementById('ip-error-1').style.display = 'inline-block'\n                    hasEmpty = true\n                }\n            }\n\n            return hasEmpty\n        }\n\n        function validateCpf(cpf) {\n            cpf = cpf.replace(/[^\\d]+/g, '')\n            if (cpf == '') return false\n            if (cpf.length != 11 ||\n                cpf == \"00000000000\" ||\n                cpf == \"11111111111\" ||\n                cpf == \"22222222222\" ||\n                cpf == \"33333333333\" ||\n                cpf == \"44444444444\" ||\n                cpf == \"55555555555\" ||\n                cpf == \"66666666666\" ||\n                cpf == \"77777777777\" ||\n                cpf == \"88888888888\" ||\n                cpf == \"99999999999\")\n                return false\n            let add = 0\n            for (let i = 0; i < 9; i++)\n                add += parseInt(cpf.charAt(i)) * (10 - i)\n            let rev = 11 - (add % 11)\n            if (rev == 10 || rev == 11)\n                rev = 0\n            if (rev != parseInt(cpf.charAt(9)))\n                return false\n            add = 0\n            for (let i = 0; i < 10; i++)\n                add += parseInt(cpf.charAt(i)) * (11 - i)\n            rev = 11 - (add % 11)\n            if (rev == 10 || rev == 11)\n                rev = 0\n            return rev == parseInt(cpf.charAt(10))\n        }\n\n        function focusInputWithError() {\n            const inputsError = document.querySelectorAll('.ip-form-control-error')\n            if (inputsError !== undefined) inputsError[0].focus()\n        }\n\n        function responseHandler(response) {\n            const token = document.querySelector(\"#ip-token\")\n            token.value = response.token\n            infinite_pay_submit = false\n            const wooCheckoutForm = $('form.woocommerce-checkout')\n            wooCheckoutForm.off('checkout_place_order', infinitePayFormHandler)\n            wooCheckoutForm.submit()\n        }\n\n        function createToken() {\n            clearErrors()\n\n            const form = document.querySelector('form.woocommerce-checkout')\n            const number = document.querySelector('#ip_ccNo')\n            const expireDate = document.querySelector('#cardExpirationMonth')\n            const expireYear = document.querySelector('#cardExpirationYear')\n            const cvv = document.querySelector('#ip_cvv')\n\n            const ipay = getIPay()\n\n            const cardValidate = ipay.cardValidate(number.value)\n            const cardExpirationValidate = ipay.cardExpirationValidate(expireYear.value, expireDate.value)\n            if (!cardValidate.valid || !cardExpirationValidate) return false\n\n            const elements = {\n                form,\n                'card-number': number,\n                'card-cvv': cvv,\n                'expiration-month': expireDate,\n                'expiration-year': expireYear\n            }\n            ipay.tokenize(elements, function (error, data) {\n                responseHandler(data)\n            })\n        }\n\n        function infinitePayFormHandler() {\n            if (infinite_pay_submit) {\n                infinite_pay_submit = false\n                return true\n            }\n            if (\n                !document.getElementById('payment_method_infinitepay').checked\n            ) return true\n\n            if (validateInputs()) return createToken()\n            return false\n        }\n\n        $(\"form.woocommerce-checkout\").on(\n            \"checkout_place_order\",\n            infinitePayFormHandler\n        )\n\n        function init() {\n            if(!!window[\"IPay\"]) return;\n\n            var head = document.getElementsByTagName(\"head\")[0];\n            var script = document.createElement(\"script\");\n            script.async = 1;\n            // TODO: Change to CDN URL\n            script.src = \"https://woo.local/wp-content/plugins/infinitepay-woocommerce/assets/ipay-1.0.0.min.js\";\n            script.onload = function() {\n                const iPay = new window.IPay({ token: wc_infinitepay_params.token })\n                iPay.fingerprint(function(error, fp){\n                    if(error){ console.error(error); return; }\n                    const inputUUID = document.querySelector(\"#ip-uuid\");\n                    inputUUID.value = fp;\n                })\n                window.iPay = iPay\n            }\n            head.parentNode.appendChild(script);\n        }\n        init()\n    })\n})(jQuery)"],"names":["$","infinite_pay_submit","additionalInfo","iPay","getIPay","window","getCheckoutForm","document","querySelector","validateInputs","clearErrors","mainInputs","validateMainInputs","additionalInputs","validateAdditionalInputs","focusInputWithError","i","querySelectorAll","length","errorElement","classList","remove","j","errorMessage","style","display","hasEmpty","form","formInputs","k","element","indexOf","getAttribute","withError","value","id","validateCpf","errorSpan","add","cardholderIdentificationType","inputDocType","getElementById","cardholderIdentificationNumber","inputDocNumber","cpf","replace","parseInt","charAt","rev","inputsError","undefined","focus","responseHandler","response","token","wooCheckoutForm","off","infinitePayFormHandler","submit","createToken","number","expireDate","expireYear","cvv","ipay","cardValidate","cardExpirationValidate","valid","elements","tokenize","error","data","checked","on","init","head","getElementsByTagName","script","createElement","async","src","onload","IPay","wc_infinitepay_params","fingerprint","fp","console","inputUUID","parentNode","appendChild","jQuery"],"sourceRoot":""}